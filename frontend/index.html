<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pattern Picker</title>
<style>
  body{font-family:system-ui;margin:24px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px}
  .card{border:1px solid #2e150b;border-radius:12px;padding:12px;cursor:pointer}
  img{width:100%;border-radius:10px;display:block}
</style>
</head>
<body>
<h1>Select a pattern</h1>
<button id="btn" disabled>Generate PDF</button>
<span id="status"></span>
<div id="grid" class="grid"></div>


<script src="/static/config.js"></script>
<script>
const API_BASE = window.CONFIG.API_BASE.replace(/\/$/, "");
let selected = null;

async function load(){
  const res = await fetch(`${API_BASE}/api/patterns`);
  if (!res.ok) throw new Error(`GET /api/patterns -> ${res.status}`);
  const patterns = await res.json();

  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  patterns.forEach(p => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<img src="${API_BASE}${p.imageUrl}"><div>${p.title}</div>`;
    card.onclick = () => {
      selected = p.id;
      document.getElementById("btn").disabled = false;

      // visual selection
      document.querySelectorAll(".card").forEach(c => c.style.border = "1px solid #20c10e");
      card.style.border = "3px solid #20c10e";
    };
    grid.appendChild(card);
  });
}

document.getElementById("btn").onclick = async () => {
  const status = document.getElementById("status");
  const btn = document.getElementById("btn");

  btn.disabled = true;
  status.textContent = " Generatingâ€¦";

  try {
    const res = await fetch(`${API_BASE}/api/generate`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ pattern_id: selected })
    });

    if (!res.ok) throw new Error(`POST /api/generate -> ${res.status}`);
    const data = await res.json();

    window.location.href = `${API_BASE}${data.downloadUrl}`;
    status.textContent = "";
  } catch (e) {
    status.textContent = ` Error: ${e.message}`;
    btn.disabled = false;
  }
};

load().catch(e => {
  document.getElementById("status").textContent = ` Error: ${e.message}`;
});
</script>



</body>
</html>
